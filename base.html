<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>High-Income / High-Investment FSAs – Ontario</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
        width: 100%;
      }
      #legend {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: white;
        padding: 12px 16px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        font-size: 14px;
        line-height: 1.5;
      }
      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 4px;
      }
      .legend-symbol {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        margin-right: 6px;
      }
      hr {
        border: none;
        border-top: 1px solid #ddd;
        margin: 6px 0;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <div id="legend"></div>

    <script>
      async function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 8.3,
          center: { lat: 44.2, lng: -79.9 },
          mapTypeId: "roadmap"
        });

        // 🔹 Carregar o JSON
        const response = await fetch("ontario_socioeconomic_clusters_geo.json");
        const data = await response.json();

        // 🔹 Filtrar e desenhar círculos cinza (15 km)
        const filtered = data.filter(d => d.socioeconomic_cluster === 1);
        filtered.forEach(d => {
          const lat = parseFloat(d.lat);
          const lon = parseFloat(d.lon);
          const fsa = d.fsa;

          if (!isNaN(lat) && !isNaN(lon)) {
            const circle = new google.maps.Circle({
              strokeOpacity: 0,
              fillColor: "#708090",
              fillOpacity: 0.25,
              map,
              center: { lat, lng: lon },
              radius: 15000
            });

            const info = new google.maps.InfoWindow({
              content: `
                <b>FSA:</b> ${fsa}<br>
                <b>Coverage radius:</b> ≈15 km
              `
            });

            circle.addListener("click", () => info.open(map));
          }
        });

        // 🏛️ City reference points
        const collingwood = { lat: 44.5008, lng: -80.2144 };
        const toronto = { lat: 43.6532, lng: -79.3832 };

        // 🏙️ City markers
        [
          { city: collingwood, label: "Collingwood City Hall" },
          { city: toronto, label: "Toronto City Hall" }
        ].forEach(obj => {
          new google.maps.Marker({
            position: obj.city,
            map,
            icon: {
              url: "http://maps.google.com/mapfiles/kml/shapes/capital_small.png",
              scaledSize: new google.maps.Size(36, 36)
            },
            title: obj.label
          });
        });

        // ⚫ Circles around both cities (40 km, black outline only)
        [
          { city: toronto, label: "Toronto 40 km radius" },
          { city: collingwood, label: "Collingwood 40 km radius" }
        ].forEach(obj => {
          new google.maps.Circle({
            strokeColor: "#000000",
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: "#000000",
            fillOpacity: 0.0,
            map,
            center: obj.city,
            radius: 40000
          });
        });

        // 🛣️ Highways (dashed black)
        const highway400 = [
          collingwood,
          { lat: 44.39, lng: -79.69 },
          { lat: 43.9, lng: -79.51 },
          toronto
        ];
        const highway10 = [
          collingwood,
          { lat: 44.3, lng: -80.0 },
          { lat: 43.9, lng: -79.9 },
          toronto
        ];

        [highway400, highway10].forEach(path => {
          new google.maps.Polyline({
            path,
            geodesic: true,
            strokeColor: "#000000",
            strokeOpacity: 0.8,
            strokeWeight: 1,
            icons: [
              {
                icon: { path: "M 0,-1 0,1", strokeOpacity: 1, scale: 4 },
                offset: "0",
                repeat: "20px"
              }
            ],
            map
          });
        });

        // 🔺 Corridor polygon (filled red)
        const corridor = [
          { lat: 44.62, lng: -80.35 },
          { lat: 44.48, lng: -79.58 },
          { lat: 44.05, lng: -79.3 },
          { lat: 43.6, lng: -79.35 },
          { lat: 43.55, lng: -79.85 },
          { lat: 43.85, lng: -80.15 },
          { lat: 44.35, lng: -80.25 },
          { lat: 44.62, lng: -80.35 }
        ];

        new google.maps.Polygon({
          paths: corridor,
          strokeColor: "#FF0000",
          strokeOpacity: 0.9,
          strokeWeight: 1,
          fillColor: "#FF0000",
          fillOpacity: 0.25,
          map
        });

        // 🧭 Legenda detalhada
        const legend = document.getElementById("legend");
        legend.innerHTML = `
          <b>Map Legend</b><br>
          <div class="legend-item">
            <div class="legend-symbol" style="background:#708090;opacity:0.25;"></div>
            ≈15 km FSA coverage areas (High-income / investment concentration)
          </div>
          <div class="legend-item">
            <div class="legend-symbol" style="border:1px solid #000;background:none;"></div>
            40 km radius – <b>Toronto area</b>
          </div>
          <div class="legend-item">
            <div class="legend-symbol" style="border:1px solid #000;background:none;"></div>
            40 km radius – <b>Collingwood area</b>
          </div>
          <div class="legend-item">
            <div class="legend-symbol" style="background:#FF0000;"></div>
            Corridor zone (≈15 km buffer around Highways 400 & 10)
          </div>
          <div class="legend-item">
            <span style="color:#000;">&#8212;&#8212;&#8212;</span>&nbsp;Highways 400 & 10 (Dashed)
          </div>
        `;

        map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(legend);
      }
    </script>

    <!-- 🔑 Google Maps API -->
   </script>

    <!-- 🔑 Carregar chave do Google Maps a partir do config.js -->
    <script src="scripts/config.js"></script>
    <script>
      // Cria dinamicamente o script do Google Maps com a chave do config.js
      const script = document.createElement("script");
      script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=initMap`;
      script.async = true;
      document.head.appendChild(script);
    </script>
  </body>
</html>